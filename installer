

# griffen install for mac
def installEverything
    #
    # xcode tools 
    #
        puts "Starting install of x-code tools"
        output = `xcode-select --install`
        if output.match(/xcode-select: error: command line tools are already installed/)
            puts "xcode tools are installed, checking for xcode update"
            list_of_updates = `softwareupdate -l`
            update_name = list_of_updates.match(/(?<=\* )Command Line Tools.+/)
            if update_name != nil
                puts "There is an update so I'm going to go ahead and install it okay?"
                gets
                puts "Okay starting installation"
                `softwareupdate --install "#{update_name[0]}"`
                puts "software update complete"
            else 
                puts "Your xcode should be up to date!"
            end
        puts "Okay xcode should be installed, press enter to continue"
        gets

    #
    # homebrew
    #
        puts "Starting install of homebrew"
        `/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"`

        #check homebrew
        response = `brew -v`
        homebrew_installed = (  nil != response.match(/Homebrew \d+\.\d+/)  )

        # FIXME, what to do if homebrew didn't install
        if not homebrew_installed
            puts "I couldn't get homebrew to install for some reason :/"
            return 
        end#if
    
        puts "Okay homebrew should be installed, press enter to continue"
        gets

    #
    # node.js
    #

        puts "okay, starting to install node"
        output = `brew install node`
        puts "okay just now ran the command for installing node" 
    
        # Does path need to be fixed?
            # lots of times when installing node
            # the node command still wont work because the 
            # computer doesnt know where the command is
            # so the path (where your computer looks) has to be manually updated
            path_fix_is_needed = output.match(/If you need to have this software first in your PATH run:/)
            path_fix = output.match(/If you need to have this software first in your PATH run:\n\s+(?<FirstPathCommand>.+)\n(?<SecondPathCommand>.+)/)
            # check for error 
                if path_fix_is_needed and (path_fix == nil)
                    puts "There is a problem :/"
                    puts "Homebrew was installing node"
                    puts "But (as usual) $PATH needed to be updated manually"
                    puts "But the regex couldn't find how to update the path"
                    puts "here is what homebrew said:"
                    puts output.gsub(/(\n|^)/,"    \n")
                    return
                end#if
            # try to add stuff to bash profile
            if path_fix != nil
                first_command = path_fix["FirstPathCommand"]
                second_command = path_fix["SecondPathCommand"]
                # extract the actual path
                first_command.sub(/^echo '/,"")
                first_command.sub(/' >> ~\/\.bash_profile$/,"")
                second_command.sub(/^echo '/,"")
                second_command.sub(/' >> ~\/\.bash_profile$/,"")
                # FIXME, check and see if those locations are already in the path/ .bash_profile
                # add those commands to the bash profile 
                bash_profile = File.open(Dir.home+'/.bash_profile','a')
                exact_install_string = "# When Griffen was installing node (through homebrew)\n# the PATH needed to be extended to include the node and npm commands\n# so the next two lines were added here in order to do that\n#{first_command}\n#{second_command}"
                # FIXME store exact_install_string somewhere so that uninstalls can be done easily
                bash_profile.puts(exact_install_string)
                bash_profile.close
            end#if 

        # check node
        response = `node -v`
        node_installed = (  nil != response.match(/v\d+\.\d+/)  )
        # check npm
        response = `npm -v`
        npm_installed = ( nil != response.match(/\d+\.\d+/))

        # FIXME, what to do if node didn't install
        if not node_installed or not npm_installed
            puts "I couldn't get node.js installed :/"
            return
        end#if
        
        puts "Okay node should be installed and checked, press enter to continue"
        gets
    #
    # pug, SASS, CoffeeScript, Electron, Electron-Dev
    #
        puts "about to install pug"
        `npm install -g pug`
        puts "about to install sass"
        `npm install -g sass`
        puts "about to install coffeescript"
        `npm install -g coffeescript`
        puts "about to install electron"
        `npm install -g electron`
        puts "about to install electron-dev"
        `npm install -g electron-dev`
        puts "okay all of those should be installed"
end#installEverything
installEverything
